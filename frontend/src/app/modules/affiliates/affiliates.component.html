<!-- src/app/affiliates/affiliates.component.html -->
<div *ngIf="showToast" class="popup-center">
    <div class="toast show align-items-center text-bg-{{toastType}} border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body">{{ message }}</div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          (click)="showToast = false"
          aria-label="Close"
        ></button>
      </div>
    </div>
  </div>
  
  <div *ngIf="!editing" class="container py-4">
    <div class="d-flex mb-3">
      <input
        type="text"
        class="form-control me-2"
        placeholder="Buscar..."
        [(ngModel)]="search"
        (ngModelChange)="filter()"
      />
      <button class="btn btn-primary" (click)="onCreate()">Crear afiliado</button>
    </div>
    <ul class="list-group">
      <li
        *ngFor="let a of filtered"
        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
        (click)="onEdit(a)"
      >
        {{ a.fullName }} ({{ a.externalId }})
        <span
          class="badge"
          [class.bg-success]="a.active"
          [class.bg-secondary]="!a.active"
        >
          {{ a.active ? 'Activo' : 'Inactivo' }}
        </span>
      </li>
    </ul>
  </div>
  
  <div *ngIf="editing" class="container py-4" style="max-width: 500px;">
    <form [formGroup]="form" (ngSubmit)="submit()">
      <div class="mb-3">
        <label class="form-label">ID Externo</label>
        <input
          class="form-control"
          formControlName="externalId"
          [ngClass]="{'is-invalid': form.get('externalId')?.touched && form.get('externalId')?.hasError('required')}"
        />
        <div class="invalid-feedback" *ngIf="form.get('externalId')?.touched && form.get('externalId')?.hasError('required')">
          El ID externo es obligatorio.
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Nombre</label>
        <input
          class="form-control"
          formControlName="firstName"
          [ngClass]="{'is-invalid': form.get('firstName')?.touched && form.get('firstName')?.hasError('required')}"
        />
        <div class="invalid-feedback" *ngIf="form.get('firstName')?.touched && form.get('firstName')?.hasError('required')">
          El nombre es obligatorio.
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Segundo Nombre</label>
        <input class="form-control" formControlName="secondName" />
      </div>
      <div class="mb-3">
        <label class="form-label">Apellido Paterno</label>
        <input
          class="form-control"
          formControlName="firstLastName"
          [ngClass]="{'is-invalid': form.get('firstLastName')?.touched && form.get('firstLastName')?.hasError('required')}"
        />
        <div class="invalid-feedback" *ngIf="form.get('firstLastName')?.touched && form.get('firstLastName')?.hasError('required')">
          El apellido paterno es obligatorio.
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Apellido Materno</label>
        <input
          class="form-control"
          formControlName="secondLastName"
          [ngClass]="{'is-invalid': form.get('secondLastName')?.touched && form.get('secondLastName')?.hasError('required')}"
        />
        <div class="invalid-feedback" *ngIf="form.get('secondLastName')?.touched && form.get('secondLastName')?.hasError('required')">
          El apellido materno es obligatorio.
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Email</label>
        <input
          class="form-control"
          formControlName="email"
          [ngClass]="{'is-invalid': form.get('email')?.touched && form.get('email')?.hasError('email')}"
        />
        <div class="invalid-feedback" *ngIf="form.get('email')?.touched && form.get('email')?.hasError('email')">
          Formato de correo inválido.
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Teléfono</label>
        <input
          class="form-control"
          formControlName="telephoneNumber"
          [ngClass]="{'is-invalid': form.get('telephoneNumber')?.touched && form.get('telephoneNumber')?.hasError('required')}"
        />
        <div class="invalid-feedback" *ngIf="form.get('telephoneNumber')?.touched && form.get('telephoneNumber')?.hasError('required')">
          El teléfono es obligatorio.
        </div>
      </div>
      <div class="form-check mb-3">
        <input type="checkbox" class="form-check-input" formControlName="active" />
        <label class="form-check-label">Activo</label>
      </div>
      <div class="d-flex justify-content-between">
        <button class="btn btn-secondary" type="button" (click)="onCancel()">Cancelar</button>
        <button class="btn btn-success" type="submit">{{ isNew ? 'Crear' : 'Guardar' }}</button>
      </div>
    </form>
  </div>
  